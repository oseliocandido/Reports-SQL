
<!-- saved from url=(0104)file:///G:/Meu%20Drive/Dados/Trabalho/Carreira/Portf%C3%B3lio/GitHub/Factory%20DownTime/M%20Queries.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>body {
      color: #000000;
      background-color: #FFFFFF;
      font-size: 24;
      font-family: Serif;
      font-weight: bold;
      font-style: italic;
      }
      h1, h2, h3, h4, h5, h6 {
      color: #000000;
      background-color: #FFFFFF;
      font-size: 24;
      font-family: Serif;
      font-weight: bold;
      font-style: italic;
      }
      table, pre {
      color: #000000;
      background-color: #FFFFFF;
      font-size: 16;
      font-family: Serif;
      font-weight: normal;
      font-style: normal;
      }
      ul, #myUL {
      list-style-type: none;
      }
      #myUL {
      margin: 0;
      padding: 0;
      }
      .caret, .dropDownCaret {
      cursor: pointer;
      }
      .caret::before {
      content: "\25B6";
      color: black;
      display: inline - block;
      margin - right: 6px;
      }
      .dropDownCaret::before {
      content: "\25BC";
      color: black;
      display: inline - block;
      margin - right: 6px;
      float: right;
      }
      .nested {
      display: none;
      }
      .active {
      display: block;
      }
   </style>
   </head><body>
      <div>Power BI Documentation</div>
      <div>
      Generated by <a href="http://radacad.com/power-bi-helper">Power BI Helper</a> (Copyright © <a href="http://radacad.com/">RADACAD</a>).<br><br><br>Factory Downtime<hr>
      </div>M Queries
      <br><br>
      <table border="1px" cellpadding="1" cellspacing="1">
         <tbody><tr><td>Name</td><td>QueryDefinition</td></tr><tr><td>fato Work Requests-2480b0b4-e834-4a45-b691-bbf3ab957b6c</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>, [Query="SELECT [Bem/Localiz]#(lf),[Centro_Custo],[Dt_Abertura],[Tipo_Servico],[Cod_Empresa],[Situacao_SS] FROM FATO.TQB_SOLICITACAO_SERVICO#(lf)WHERE Dt_Abertura BETWEEN '2020-01-01' AND CONVERT(DATE,GETDATE())#(lf)"]),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(Fonte, each [Cod_Empresa] = CodEmpresa),<br><br>    #<font color="red">"Tipo Alterado"</font> = <font color="purple">Table.TransformColumnTypes</font>(#<font color="red">"Linhas Filtradas"</font>,{{<font color="red">"Dt_Abertura"</font>, <font color="blue">type</font> <font color="blue">date</font>}})<br><br><font color="blue">in</font><br><br>    #<font color="red">"Tipo Alterado"</font></td></tr><tr><td>fato Work Orders-e1af0c01-fcea-4ecb-a3ad-63d2a0a93c8c</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>, [Query="SELECT [Cod_Empresa]#(lf)  ,[Bem]#(lf) ,[Centro_Custo]#(lf),[nome_servico]#(lf),CONVERT(CHAR,[Real_Parada_DTInicio]) + ' ' + [Real_Parada_HInicio] + ':00' AS 'Inicio'#(lf)#(tab) ,CONVERT(CHAR,[Real_Parada_DTFim]) + ' ' + [Real_Parada_HFim] + ':00' AS 'Fim'#(lf) #(lf)   ,[Termino]#(lf) ,[Situacao_OS]#(lf) ,[Ordem_Serv] + [Plano_Manut] as 'Relacio_ordem_plano' FROM [DW].[fato].[STJ_OS_MANUTENCAO]#(lf) WHERE [Real_Parada_DTInicio] BETWEEN '2020-01-01' AND CONVERT(DATE,GETDATE()) AND [Real_Parada_HInicio] &lt;&gt; '     ' AND [Real_Parada_HInicio] &lt;&gt; '  :  '"]),<br><br>    #<font color="red">"Tipo Alterado"</font> = <font color="purple">Table.TransformColumnTypes</font>(<font color="red">Fonte
</font>,{{<font color="red">"Inicio"</font>, <font color="blue">type</font> datetime}, {<font color="red">"Fim"</font>, <font color="blue">type</font> datetime}}),<br><br>    #<font color="red">"Subtração da Hora Inserida"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Tipo Alterado"</font>, <font color="red">"Horas"</font>, each [Fim] - [Inicio], <font color="blue">type</font> duration),<br><br>    #<font color="red">"Total de Horas Calculadas"</font> = <font color="purple">Table.TransformColumns</font>(#<font color="red">"Subtração da Hora Inserida"</font>,{{<font color="red">"Horas"</font>, <font color="purple">Duration.TotalHours</font>, <font color="blue">type</font> number}}),<br><br>    #<font color="red">"Colunas Removidas"</font> = <font color="purple">Table.RemoveColumns</font>(#<font color="red">"Total de Horas Calculadas"</font>,{<font color="red">"Inicio"</font>, <font color="red">"Fim"</font>}),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(#<font color="red">"Colunas Removidas"</font>, each [Cod_Empresa] = CodEmpresa)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Linhas Filtradas"</font></td></tr><tr><td>dim Service Type-3bb285ba-0d0c-443c-9b9c-1a75a0b878fb</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>),<br><br>    dim_TQ3_TIPO_SERVICO_SS = Fonte{[Schema=<font color="red">"dim"</font>,Item=<font color="red">"TQ3_TIPO_SERVICO_SS"</font>]}[Data],<br><br>    #<font color="red">"Coluna Mesclada Inserida"</font> = <font color="purple">Table.AddColumn</font>(dim_TQ3_TIPO_SERVICO_SS, "Cod + Nome Serv.", each <font color="purple">Text.Combine</font>({<font color="purple">Text.Trim</font>([Cod_Servico]), " - ", <font color="purple">Text.Trim</font>([Nome_Servico])}), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(#<font color="red">"Coluna Mesclada Inserida"</font>, each [Cod_Empresa] = CodEmpresa)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Linhas Filtradas"</font></td></tr><tr><td>dim Cost Center-e5de829a-c8f0-44bf-9cee-efbff23158ad</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>),<br><br>    dim_Centro_de_Custos = Fonte{[Schema=<font color="red">"dim"</font>,Item=<font color="red">"Centro_de_Custos"</font>]}[Data],<br><br>    #<font color="red">"Coluna Mesclada Inserida"</font> = <font color="purple">Table.AddColumn</font>(<font color="red">dim_Centro_de_Custos</font>, "Cod. + Nome CCT", each <font color="purple">Text.Combine</font>({<font color="purple">Text.Trim</font>([CTT_CUSTO]), " - ", <font color="purple">Text.Trim</font>([CTT_DESC01])}), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(#<font color="red">"Coluna Mesclada Inserida"</font>, each [Cod_Empresa] = CodEmpresa)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Linhas Filtradas"</font></td></tr><tr><td>fato Detail Work Order-71dc8bc3-d537-41a8-a5e4-16d647e62aea</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>, [Query="SELECT [Cod_Empresa]#(lf),[DescProblema]#(lf),[DescCausa]#(lf),[DescSolucao]#(lf),[OrdemPlano]#(lf)  FROM [DW].[fato].[Ocorrencias_Manutencao]"]),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(Fonte, each [Cod_Empresa] = CodEmpresa)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Linhas Filtradas"</font></td></tr><tr><td>dim Calendar-e8c9437a-4c30-4175-8c20-70bc8b4c36c0</td><td><font color="blue">let</font><br><br>    Datas = <font color="purple">Table.FromList</font>({<font color="purple">Number.From</font>(#<font color="blue">date</font>(2020,01,01))..<font color="purple">Number.From</font>(<font color="purple">Date.EndOfYear</font>(<font color="purple">Date.From</font>(<font color="purple">DateTime.LocalNow</font>())))}, <font color="purple">Splitter.SplitByNothing</font>(), <font color="blue">null</font>, <font color="blue">null</font>, <font color="purple">ExtraValues.Error</font>),<br><br>    #<font color="red">"Renamed Columns"</font> = <font color="purple">Table.RenameColumns</font>(Datas,{{<font color="red">"Column1"</font>, <font color="red">"Calendario"</font>}}),<br><br>    #<font color="red">"To_Date"</font> = <font color="purple">Table.TransformColumnTypes</font>(#<font color="red">"Renamed Columns"</font>,{{<font color="red">"Calendario"</font>, <font color="blue">type</font> <font color="blue">date</font>}}),<br><br>    #<font color="red">"Ano Inserido"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"To_Date"</font>, <font color="red">"Ano"</font>, each <font color="purple">Date.Year</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Mês Inserido"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Ano Inserido"</font>, <font color="red">"Mês"</font>, each <font color="purple">Date.Month</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Dia Inserido"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Mês Inserido"</font>, <font color="red">"Dia do Mês"</font>, each <font color="purple">Date.Day</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Numero do Trimestre"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Dia Inserido"</font>, <font color="red">"Trimestre"</font>, each <font color="purple">Date.QuarterOfYear</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Nome do Trimestre"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Numero do Trimestre"</font>, <font color="red">"Nome do Trimestre"</font>, each <font color="red">"Trim "</font> &amp; <font color="purple">Text.From</font>([Trimestre], "pt-BR"), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Numero da Semana do Ano"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Nome do Trimestre"</font>, <font color="red">"Semana do Ano"</font>, each <font color="purple">Date.WeekOfYear</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Nome da Semana do Ano"</font> = <font color="purple">Table.AddColumn</font>( #<font color="red">"Numero da Semana do Ano"</font>, <font color="red">"Nome da Semana do Ano"</font>, each <font color="red">"Sem "</font> &amp; <font color="purple">Text.From</font>([Semana do Ano], "pt-BR"), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Nome do Mês"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Nome da Semana do Ano"</font>, <font color="red">"Nome do Mês"</font>, each <font color="purple">Date.Month</font>Name([Calendario]), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #"Mes-Ano Abrevs"= <font color="purple">Table.AddColumn</font>(#<font color="red">"Nome do Mês"</font>, <font color="red">"Mês Ano Abrevs."</font>, each <font color="purple">Text.Combine</font>({<font color="purple">Text.Start</font>([Nome do Mês], 3), <font color="red">"/"</font>, <font color="purple">Text.End</font>(<font color="purple">Text.From</font>([Ano], "pt-BR"),2)}),<font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Nome do Dia da Semana"</font> = <font color="purple">Table.AddColumn</font>(#"Mes-Ano Abrevs<font color="red">", "</font>Nome do Dia da Semana", each <font color="purple">Date.Day</font>OfWeekName([Calendario]), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Semana do Mês"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Nome do Dia da Semana"</font>, <font color="red">"Semana do Mês"</font>, each <font color="purple">Date.WeekOfMonth</font>([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Nome da Semana do Mês"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Semana do Mês"</font>, <font color="red">"Nome da Semana do Mês"</font>, each <font color="red">"Sem "</font> &amp; <font color="purple">Text.From</font>([Semana do Mês], "pt-BR"), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Mês_Ano_Abrev"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Nome da Semana do Mês"</font>, <font color="red">"Mês Ano Abrev."</font>, each <font color="purple">Text.Combine</font>({<font color="purple">Text.Start</font>([Nome do Mês], 3), <font color="red">"/"</font>, <font color="purple">Text.From</font>([Ano], "pt-BR")}), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Dia da Semana"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Mês_Ano_Abrev"</font>, <font color="red">"Dia da Semana"</font>, each <font color="purple">Date.Day</font>OfWeek([Calendario]), <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Dia Util"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Dia da Semana"</font>, <font color="red">"Dia Util"</font>, each if [Dia da Semana] = 0 then 0 else if [Dia da Semana] = 6 then 0 else 1,<font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Ano Mes Sort Order"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Dia Util"</font> , <font color="red">"AnoMes"</font>, each [Ano] * 100 + [Mês], <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Ano Mes Dia Sort Order"</font> = <font color="purple">Table.AddColumn</font>( #<font color="red">"Ano Mes Sort Order"</font>, <font color="red">"AnoMesDia"</font>, each [Ano] * 10000 + [Mês] * 100 + [Dia do Mês], <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Mes Abrev"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Ano Mes Dia Sort Order"</font>, <font color="red">"Mês Abrev."</font>, each <font color="purple">Text.Start</font>([Nome do Mês], 3), <font color="blue">type</font> <font color="blue">text</font>),<br><br>    #<font color="red">"Datas Passadas"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Mes Abrev"</font>, "Passado?", each if [AnoMesDia] &lt; (<font color="purple">Date.Year</font>(<font color="purple">DateTime.LocalNow</font>())*10000 + <font color="purple">Date.Month</font>(<font color="purple">DateTime.LocalNow</font>())*100 + <font color="purple">Date.Day</font>(<font color="purple">DateTime.LocalNow</font>())) then 1 else 0, <font color="purple">Int64.Type</font>),<br><br>    #<font color="red">"Mes Atual"</font> = <font color="purple">Table.AddColumn</font>(#<font color="red">"Datas Passadas"</font>, <font color="red">"Mês Ano Atual"</font>, each if [Mês] = <font color="purple">Date.Month</font>(<font color="purple">DateTime.LocalNow</font>()) and [Ano] = <font color="purple">Date.Year</font>(<font color="purple">DateTime.LocalNow</font>()) then 1 else 0, <font color="purple">Int64.Type</font>)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Mes Atual"</font></td></tr><tr><td>Measures-62a01abd-1339-4682-bf62-1a6d558924fe</td><td><font color="blue">let</font><br><br>    Source = <font color="purple">Table.FromRows</font>(<font color="purple">Json.Document</font>(<font color="purple">Binary.Decompress</font>(<font color="purple">Binary.From</font>Text(<font color="red">"i45WMlKKjQUA"</font>, <font color="purple">BinaryEncoding.Base64</font>), <font color="purple">Compression.Deflate</font>)), <font color="blue">let</font> _t = ((<font color="blue">type</font> nullable <font color="blue">text</font>) meta [Serialized.Text = <font color="blue">true</font>]) <font color="blue">in</font> <font color="blue">type</font> table [a = _t]),<br><br>    #<font color="red">"Changed Type"</font> = <font color="purple">Table.TransformColumnTypes</font>(Source,{{<font color="red">"a"</font>, <font color="purple">Int64.Type</font>}}),<br><br>    #<font color="red">"Removed Columns"</font> = <font color="purple">Table.RemoveColumns</font>(#<font color="red">"Changed Type"</font>,{<font color="red">"a"</font>})<br><br><font color="blue">in</font><br><br>    #<font color="red">"Removed Columns"</font></td></tr><tr><td>dim Factory CostCenter-d9b3af3e-26ce-4526-b9cb-8a92c85e3895</td><td><font color="blue">let</font><br><br>    Source = <font color="purple">Excel.Workbook</font>(<font color="purple">File.Contents</font>(FilePath), <font color="blue">null</font>, <font color="blue">true</font>),<br><br>    Fabrica_CCT_Table = Source{[Item=<font color="red">"Fabrica_CCT"</font>,Kind=<font color="red">"Table"</font>]}[Data],<br><br>    #<font color="red">"Removed Other Columns"</font> = <font color="purple">Table.SelectColumns</font>(Fabrica_CCT_Table,{<font color="red">"Cod.Empresa"</font>, <font color="red">"Fábrica"</font>, <font color="red">"CC"</font>}),<br><br>    #<font color="red">"Changed Type"</font> = <font color="purple">Table.TransformColumnTypes</font>(#<font color="red">"Removed Other Columns"</font>,{{<font color="red">"Fábrica"</font>, <font color="blue">type</font> <font color="blue">text</font>}, {<font color="red">"CC"</font>, <font color="purple">Int64.Type</font>}, {<font color="red">"Cod.Empresa"</font>, <font color="blue">type</font> <font color="blue">text</font>}})<br><br><font color="blue">in</font><br><br>    #<font color="red">"Changed Type"</font></td></tr><tr><td>dim Machines-99429470-dea3-4e59-b056-e3ecde7b99a5</td><td><font color="blue">let</font><br><br>    Fonte = <font color="purple">Sql.Database</font>(<font color="red">Server</font>, <font color="red">Database</font>, [Query="SELECT [Cod_Empresa]#(lf) ,[Bem]#(lf) ,[DESC_FAMILIA]#(lf) FROM [DW].[dim].[ST9_Bens_Familia]"]),<br><br>    #<font color="red">"Linhas Filtradas"</font> = <font color="purple">Table.SelectRows</font>(Fonte, each [Cod_Empresa] = CodEmpresa)<br><br><font color="blue">in</font><br><br>    #<font color="red">"Linhas Filtradas"</font></td></tr></tbody>
      </table>
      <script>
         var toggler = document.getElementsByClassName("caret");
         for (var i = 0; i < toggler.length; i++){
         	toggler[i].addEventListener("click", function() {
         		this.parentElement.querySelector(".nested").classList.toggle("active");
         	});
         }
         	
         var togglerAll = document.getElementsByClassName("dropDownCaret");
         for (var j=0; j<togglerAll.length; j++){
         	togglerAll[j].addEventListener("click", function(event){
         		if (event.currentTarget != event.target) return;
         		if(this.parentElement.querySelector(".nested").classList.contains("active")){
         			this.querySelectorAll(".nested").forEach(function(currentValue, currentIndex, listObj) {
         				if(currentValue.classList.contains("active")){
         					currentValue.classList.remove("active");
         				}
         			});
         		}
         		else{
         			this.querySelectorAll(".nested").forEach(function(currentValue, currentIndex, listObj) {
         				if(!currentValue.classList.contains("active")){
         					currentValue.classList.add("active");
         				}
         			});
         		}
         	});
         }
      </script>
   
</body></html>